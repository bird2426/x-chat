# AI 多模态聊天机器人 + Agent 工具系统

这是一个基于 [Next.js](https://nextjs.org/) 的 AI 聊天机器人，支持**多个 AI 提供商**、**视频/图片上传**和**智能工具调用**。

✅ **所有模型已测试并验证可用** - 确保每个模型都能正常工作，无虚假配置。

## 功能

- ✨ 现代化的 UI 设计 (Glassmorphism)
- 🤖 支持多个 AI 提供商:
  - **Google Gemini** (2.5 Flash) - 支持视频和图片
  - **通义千问 Qwen** (9个模型可选) - 部分支持图片
- 📹 支持上传视频和图片进行多模态对话
- 🔄 可在界面中切换不同的 AI 模型
- 🛠️ **Agent 工具系统** - AI 可以自动调用工具来完成任务
  - ☀️ 天气查询 - 获取任意城市的天气信息（模拟）
  - 🔍 网页搜索 - 使用 Tavily API 搜索互联网（真实搜索）
  - 🧮 计算器 - 执行数学计算
  - ⏰ 时间查询 - 获取当前时间
- 💾 自动保存聊天历史和模型选择
- 🚨 **智能错误处理** - 自动推荐备用模型并一键切换
- 🚀 一键部署到 Vercel

## Agent 工具系统介绍

本项目实现了一个完整的 Agent 工具调用系统，参考了 [Hello-Agents](https://github.com/datawhalechina/hello-agents) 项目的设计理念。

### 什么是 Agent？

Agent (智能体) 不仅仅是一个聊天机器人，它可以：
1. **理解用户意图** - 分析用户问题
2. **选择合适工具** - 决定需要调用哪些工具
3. **执行工具调用** - 自动调用工具获取信息
4. **整合结果** - 将工具结果整合成最终答案

### 如何使用 Agent 工具？

**无需手动启用！** 本项目已默认开启智能 Agent 模式。你只需要像平时一样聊天，AI 会自动判断是否需要调用工具。

**切换模型：**
- 点击顶部标题栏（显示当前模型名称的地方）即可打开模型选择器
- 选择不同的 AI 提供商和模型

### 应用场景示例

#### 1. 天气查询
**场景：** 用户想知道某个城市的天气情况

```
用户: 北京今天天气怎么样？
AI: 北京当前天气：晴，温度15°C，湿度45%。适合外出活动！
```

**场景：** 查询未来天气
```
用户: 明天上海天气如何？
AI: 上海明天预计是多云，温度20°C，记得带伞备用。
```

#### 2. 网页搜索
**场景：** 用户需要最新的互联网信息

```
用户: TypeScript 5.0 有哪些新特性？

AI 自动调用: search_web(query="TypeScript 5.0 新特性")
工具返回: [搜索结果包含最新的 TS 5.0 特性]

AI 回复: 根据最新资料，TypeScript 5.0 的主要新特性包括：
1. Decorators 装饰器正式支持
2. const 类型参数
3. 更好的枚举支持
...
```

**注意：** 网页搜索需要配置 `TAVILY_API_KEY` 环境变量才能使用真实搜索，否则返回模拟结果。

#### 3. 数学计算
**场景：** 用户需要进行复杂计算

```
用户: 帮我计算 (123 + 456) * 2

AI 自动调用: calculate(expression="(123 + 456) * 2")
工具返回: 计算结果: (123 + 456) * 2 = 1158

AI 回复: 计算结果是 1158
```

#### 4. 时间查询
**场景：** 用户需要知道当前时间

```
用户: 现在几点了？

AI 自动调用: get_current_time()
工具返回: 当前时间：2026-01-19 14:30:25

AI 回复: 现在是 2026年1月19日 14:30:25
```

#### 5. 多工具组合
**场景：** 一个问题需要调用多个工具

```
用户: 北京现在几点？天气怎么样？

AI 自动调用:
  1. get_current_time()
  2. get_weather(city="北京")

工具返回:
  1. 当前时间：2026-01-19 14:30:25
  2. 北京当前天气：晴，温度15°C，湿度45%

AI 回复: 现在是下午 2:30，北京天气晴朗，温度15°C，湿度45%。是个不错的下午！
```

### 工具调用过程

当你启用工具后，每次对话都会经历以下过程：

1. **用户提问** → 2. **AI 判断是否需要工具** → 3. **调用相应工具** → 4. **获取工具结果** → 5. **AI 基于结果回答**

在聊天界面中，你会看到：
- 🛠️ **工具调用记录** - 显示调用了哪些工具、传入了什么参数、得到了什么结果
- **最终回答** - AI 基于工具结果给出的答案

### 注意事项

1. **工具开关必须启用** - 只有点击 🛠️ 按钮启用工具后，AI 才能调用工具
2. **不是所有模型都适合** - 建议使用 Gemini 2.5 Flash 或 Qwen Plus/Max 等较强的模型
3. **工具调用需要时间** - 调用工具和二次请求 AI 需要额外时间，请耐心等待
4. **搜索需要 API Key** - 真实网页搜索需要配置 TAVILY_API_KEY

### 使用示例

启用工具后，AI 可以自动调用工具来回答问题：

**用户**: 北京今天天气怎么样？
**AI**: (自动调用天气工具) 北京当前天气：晴，温度15°C，湿度45%

**用户**: 帮我计算 (123 + 456) * 2
**AI**: (自动调用计算器) 计算结果: (123 + 456) * 2 = 1158

**用户**: 搜索一下 TypeScript 最新版本
**AI**: (自动调用搜索工具) 根据搜索结果，TypeScript 最新版本是...

## 支持的模型

### Google Gemini
- **Gemini 2.5 Flash** ⭐ - 最新版本，支持视频和图片，推荐首选

### 通义千问 (Qwen)

**免费模型（推荐）：**
- **Qwen Flash** ⭐ - 免费通用模型，日常对话首选
- **DeepSeek V3.2** - 免费代码专用模型，编程任务优先
- **Qwen3 Coder Flash** - 免费代码模型，编程任务备选
- **Qwen MT Flash** - 免费翻译专用模型

**付费模型（可能需要额度）：**
- **Qwen Turbo** - 快速响应
- **Qwen Plus** - 平衡性能
- **Qwen Max** - 最强性能
- **Qwen VL Plus** - 支持图片理解
- **Qwen VL Max** - 增强的图片理解能力

> 💡 **提示**: 免费模型提供丰富的使用额度，建议优先使用！
> ✅ **已验证**: 所有10个模型均已测试，确保可正常使用。

## 快速开始

1. **安装依赖**
   ```bash
   npm install
   ```

2. **配置环境变量**
   
   创建 `.env.local` 文件并添加你的 API Keys：
   ```env
   # Google Gemini API Key (可选)
   GOOGLE_API_KEY=your_google_api_key_here
   
   # 通义千问 API Key (可选)
   QWEN_API_KEY=your_qwen_api_key_here
   
   # Tavily 搜索 API Key (可选 - 用于真实网页搜索)
   TAVILY_API_KEY=your_tavily_api_key_here
   ```

   **获取 API Keys:**
   - Google Gemini: [Google AI Studio](https://aistudio.google.com/)
   - 通义千问: [阿里云百炼平台](https://dashscope.aliyun.com/)
   - Tavily Search: [Tavily](https://tavily.com/) (免费 1000 次/月)

   > 注意：至少需要配置一个 AI 提供商的 API Key 才能使用。Tavily API Key 是可选的，不配置时搜索功能将返回模拟结果。

3. **运行开发服务器**
   ```bash
   npm run dev
   ```
   打开 [http://localhost:3000](http://localhost:3000) 即可使用。

## 使用说明

1. **切换模型** - 点击顶部标题栏（显示模型名称的地方）可以切换 AI 模型
2. **智能工具** - 系统默认启用 Agent 工具，无需手动开启
3. **上传媒体** - 点击 📷 按钮上传图片或视频（选择支持的模型）
4. **智能错误处理** ⭐ - 当模型调用失败时：
   - 系统会显示友好的错误提示（图标 + 详细说明）
   - 自动推荐合适的备用模型
   - 一键快速切换到推荐模型，或手动选择其他模型
5. **聊天历史** - 自动保存在浏览器中（最多60条）

### 智能错误处理示例

**场景：配额用完**
```
Bot: 📊 Gemini 2.5 Flash 配额已用完

💡 建议切换到免费的 Qwen Flash 模型继续使用

🔄 建议切换到：通义千问

[🔄 切换到 Qwen]  [⚙️ 手动选择]
```

**场景：代码任务推荐**
- 如果 Google 失败且检测到代码相关任务
- 自动推荐 DeepSeek V3.2（代码专用免费模型）

**场景：翻译任务推荐**
- 检测到翻译任务时推荐 Qwen MT Flash

## 部署到 Vercel

1. 将本项目上传到 GitHub
2. 登录 [Vercel](https://vercel.com/)
3. 点击 "Add New..." -> "Project"，选择刚才的 GitHub 仓库
4. 在部署设置的 **Environment Variables** 部分，添加 .env.local 文件中的环境变量
5. 点击 **Deploy**

等待几十秒，你的聊天机器人就上线了！

## 技术栈

- Next.js 16
- React 19
- TypeScript
- Google Generative AI SDK
- OpenAI SDK (兼容通义千问 API)

## 许可证

MIT
